<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interview Chatbot</title>
    <link rel="stylesheet" href="/styles.css">
   
    <link rel="icon" href="/favicon.ico">

</head>
<body>
    <div id="setupOverlay" class="setup-overlay">
        <div class="setup-panel">
            <div class="setup-top-bar">
                <div class="setup-rec">
                    <span class="rec-dot"></span>
                    <span>REC</span>
                </div>
                <div class="setup-meta">
                    <span id="setupBandwidth">-- mb/s</span>
                    <button id="setupHelpBtn" class="setup-help">Help</button>
                </div>
            </div>
            <div class="setup-header">
                <h2>Setting up Device</h2>
                <p>Complete the checks below before joining the interview.</p>
                <div class="setup-steps">
                    <div class="setup-step-node active" data-step-index="0">
                        <span class="step-number">1</span>
                        <span>Camera Test</span>
                    </div>
                    <div class="setup-step-node" data-step-index="1">
                        <span class="step-number">2</span>
                        <span>Microphone Test</span>
                    </div>
                    <div class="setup-step-node" data-step-index="2">
                        <span class="step-number">3</span>
                        <span>Speaker Test</span>
                    </div>
                    <div class="setup-step-node" data-step-index="3">
                        <span class="step-number">4</span>
                        <span>Screen Share</span>
                    </div>
                </div>
            </div>

            <div class="setup-stage-container">
                <div id="cameraStep" class="setup-stage visible">
                    <p class="setup-instruction">Center yourself in the frame and confirm your camera feed is clear.</p>
                    <video id="setupCameraPreview" autoplay playsinline muted></video>
                    <div class="setup-status" id="cameraStatus">Requesting camera access‚Ä¶</div>
                    <button id="cameraRetryBtn" class="setup-secondary">Retry Camera</button>
                </div>

                <div id="microphoneStep" class="setup-stage">
                    <p class="setup-instruction">Unmute and read ‚ÄúMy microphone is working correctly‚Äù. We‚Äôll detect your voice level.</p>
                    <div class="mic-visualizer">
                        <div id="micLevelBar"></div>
                    </div>
                    <div class="setup-status" id="microphoneStatus">Awaiting microphone input‚Ä¶</div>
                    <button id="microphoneRetryBtn" class="setup-secondary">Retry Microphone</button>
                </div>

                    <div id="speakerStep" class="setup-stage">
                    <p class="setup-instruction">Click play to hear a tone, then confirm you heard it through your speakers.</p>
                    <div class="speaker-actions">
                        <button id="playSpeakerTest" class="setup-primary">Play Test Tone</button>
                        <button id="confirmSpeakerTest" class="setup-secondary" disabled>I heard it</button>
                    </div>
                    <div class="setup-status" id="speakerStatus">Waiting for playback‚Ä¶</div>
                </div>

                <div id="screenStep" class="setup-stage">
                    <p class="setup-instruction">Share your screen or tab to ensure permissions are granted before the interview.</p>
                    <button id="startScreenShare" class="setup-primary">Start Screen Share</button>
                    <video id="screenPreview" autoplay playsinline muted></video>
                    <div class="setup-status" id="screenStatus">Screen share not started.</div>
                </div>
            </div>

            <div class="setup-actions">
                <button id="setupBackBtn" class="setup-secondary" disabled>Back</button>
                <button id="setupNextBtn" class="setup-primary" disabled>Next</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <div class="title-group">
                <h1>Interview Chatbot</h1>
                <p class="subtitle">AI-powered interviewer with multimodal intelligence</p>
            </div>
            <div class="header-actions">
                <button class="theme-toggle" id="themeToggle" title="Toggle theme">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <span id="themeToggleText">Dark</span>
                </button>
                <button id="voiceToggle" class="btn btn-ghost" disabled>
                    <span class="dot"></span>
                    <span>AI Voice: Off</span>
                </button>
                <div class="recording-status">
                    <span id="recording-indicator" class="indicator"></span>
                    <span id="recording-text">Not Recording</span>
                </div>
            </div>
        </header>

        <div class="main-content">
            <div class="left-column">
                <div class="video-section">
                    <video id="videoPreview" autoplay muted playsinline></video>
                    <div class="video-controls">
                        <button id="stopBtn" class="btn btn-danger" disabled>Stop Interview</button>
                        <button id="resumeBtn" class="btn btn-primary" disabled>Resume Interview</button>
                        <button id="downloadBtn" class="btn btn-secondary" disabled>Download Recordings</button>
                    </div>
                    <div class="stats">
                        <div class="stat-item">
                            <span class="stat-label">Screenshots:</span>
                            <span id="screenshot-count">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Duration:</span>
                            <span id="duration">00:00</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Questions Asked:</span>
                            <span id="question-progress">0 / 0</span>
                        </div>
                    </div>
                </div>

                <div class="ai-panel">
                    <div class="agent-visual">
                        <img id="agentPhoto" alt="AI Agent" />
                        <span class="agent-ribbon" id="agentRibbon">AI Interviewer</span>
                    </div>
                    <div class="ai-details">
                        <div class="detail-row">
                            <span class="detail-label">Agent</span>
                            <div class="agent-controls">
                                <select id="agentSelect"></select>
                                <button id="shuffleAgentBtn" class="mini-btn" title="Surprise me">üé≤</button>
                            </div>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Persona</span>
                            <span id="agentRole" class="detail-value">Loading‚Ä¶</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Voice</span>
                            <span id="agentVoice" class="detail-value">Syncing‚Ä¶</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Voice Status</span>
                            <span id="voiceStatus" class="detail-value">Muted</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Next Question</span>
                            <span id="nextQuestion" class="detail-value">Waiting to begin‚Ä¶</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="right-column">
                  <div class="chat-section-modern">
                    <div class="chat-header">
                        <div class="chat-icon">üí¨</div>
                        <h3>Conversation</h3>
                    </div>
                    <div id="chatMessages" class="chat-messages-modern"></div>
                    <div class="chat-input-container-modern">
                        <input type="text" id="userInput" placeholder="Type your answer or speak..." disabled>
                        <button id="sendBtn" class="btn-send-modern" disabled>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                        </button>
                    </div>
                </div>
                 <div class="transcript-panel-modern">
                    <div class="transcript-header">
                        <div class="transcript-icon">üé§</div>
                        <h3>Live Transcript</h3>
                        <span id="transcript-status" class="status-badge">Offline</span>
                    </div>
                    <div id="liveTranscript" class="transcript-content">Speech recognition inactive. Start speaking to see your words appear here.</div>
                </div>
                <div class="analytics-panel-modern">
                    <div class="analytics-header">
                        <div class="analytics-icon">üìä</div>
                        <h3>Real-Time Insights</h3>
                    </div>
                    <div id="analyticsFeed" class="analytics-feed-modern">
                        <div class="insight-placeholder">
                            <div class="insight-icon">üí°</div>
                            <p>Insights will appear as you answer questions</p>
                        </div>
                    </div>
                </div>
               
            </div>
        </div>
    </div>

    <div id="reportOverlay" class="report-overlay hidden">
        <div class="report-panel">
            <div class="report-header">
                <div>
                    <p class="report-label">Performance Report</p>
                    <h2 id="reportCandidateName">Candidate</h2>
                </div>
                <div class="report-actions">
                    <button id="downloadReportBtn" class="setup-primary">Download</button>
                    <button id="closeReportBtn" class="setup-secondary">Close</button>
                </div>
            </div>
            <div class="report-overview">
                <div>
                    <p class="report-label">Interview Name</p>
                    <h4 id="reportInterviewName">Interview</h4>
                </div>
                <div>
                    <p class="report-label">Overall Score</p>
                    <h1 id="reportOverallScore">0/10</h1>
                </div>
                <div>
                    <p class="report-label">Total Time Spent</p>
                    <h4 id="reportTotalTime">00m 00s</h4>
                </div>
                <div>
                    <p class="report-label">Total Questions</p>
                    <h4 id="reportQuestionCount">0</h4>
                </div>
            </div>
            <div>
                <h3 class="report-section-title">Detailed Feedback on Evaluation Parameters</h3>
                <div id="reportCategoryList" class="report-category-list"></div>
            </div>
        </div>
    </div>

    <!-- Coding Section Overlay -->
    <div id="codingOverlay" class="report-overlay hidden">
        <div class="report-panel" style="max-width: 1000px; width: 95vw;">
            <div class="report-header">
                <div>
                    <h2 id="codingSectionTitle">Coding Section</h2>
                    <p style="margin-top: 8px; opacity: 0.8;" id="codingSectionSubtitle">Let's test your coding skills</p>
                </div>
                <button id="closeCodingBtn" class="setup-secondary" style="padding: 8px 16px;">Skip Coding</button>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 24px;">
                <!-- Left: Question and Instructions -->
                <div style="display: flex; flex-direction: column; gap: 16px;">
                    <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 16px;">
                        <h3 style="margin-bottom: 12px; font-size: 16px;">Question</h3>
                        <p id="codingQuestionText" style="line-height: 1.6; font-size: 14px;">Loading question...</p>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 16px;">
                        <h3 style="margin-bottom: 12px; font-size: 16px;">Instructions</h3>
                        <ul style="list-style: none; padding: 0; margin: 0; font-size: 13px; line-height: 1.8;">
                            <li style="padding: 4px 0;">‚úì Write your code in the editor</li>
                            <li style="padding: 4px 0;">‚úì Click "Run Code" to test your solution</li>
                            <li style="padding: 4px 0;">‚úì Check the output to verify correctness</li>
                            <li style="padding: 4px 0;">‚úì Click "Submit Answer" when ready</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Right: Code Editor and Output -->
                <div style="display: flex; flex-direction: column; gap: 16px;">
                    <div style="background: #1e1e1e; border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1);">
                        <div style="background: #252526; padding: 8px 16px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <span id="codingLanguageLabel" style="font-weight: 600; font-size: 13px;">Python</span>
                            <div style="display: flex; gap: 8px;">
                                <button id="runCodeBtn" class="setup-primary" style="padding: 6px 14px; font-size: 13px;">Run Code</button>
                                <button id="submitCodeBtn" class="setup-primary" style="padding: 6px 14px; font-size: 13px;">Submit Answer</button>
                            </div>
                        </div>
                        <textarea id="codeEditor" style="width: 100%; min-height: 300px; padding: 16px; background: #1e1e1e; color: #d4d4d4; font-family: 'Courier New', monospace; font-size: 14px; border: none; outline: none; resize: vertical;" placeholder="# Write your code here..."></textarea>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 16px; min-height: 150px;">
                        <h3 style="margin-bottom: 12px; font-size: 16px;">Output</h3>
                        <pre id="codeOutput" style="background: rgba(0,0,0,0.3); padding: 12px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 13px; color: #d4d4d4; white-space: pre-wrap; word-wrap: break-word; margin: 0; min-height: 100px;">Output will appear here after running your code...</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Completion Popup -->
    <div id="completionOverlay" class="report-overlay hidden">
        <div class="report-panel" style="max-width: 600px;">
            <div class="report-header">
                <div>
                    <h2>Interview Complete!</h2>
                    <p style="margin-top: 8px; opacity: 0.8;">Thank you for participating in the interview.</p>
                </div>
            </div>
            
            <div style="margin: 24px 0;">
                <p style="margin-bottom: 16px; font-size: 15px;">Your interview has been completed. You can:</p>
                <ul style="list-style: none; padding: 0; margin: 0 0 24px 0;">
                    <li style="padding: 8px 0; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 20px;">üìä</span>
                        <span>Review your performance report (already shown)</span>
                    </li>
                    <li style="padding: 8px 0; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 20px;">üíæ</span>
                        <span>Download your recordings and report</span>
                    </li>
                    <li style="padding: 8px 0; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 20px;">üìù</span>
                        <span>Share your feedback below</span>
                    </li>
                </ul>
            </div>

            <!-- Feedback Form -->
            <div style="margin: 24px 0;">
                <h3 style="margin-bottom: 16px; font-size: 18px;">Your Feedback</h3>
                <form id="feedbackForm" style="display: flex; flex-direction: column; gap: 16px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-size: 14px; opacity: 0.9;">
                            How would you rate your interview experience?
                        </label>
                        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: rgba(255,255,255,0.1); border-radius: 8px; border: 1px solid rgba(255,255,255,0.2);">
                                <input type="radio" name="rating" value="5" style="margin: 0;">
                                <span>Excellent (5)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: rgba(255,255,255,0.1); border-radius: 8px; border: 1px solid rgba(255,255,255,0.2);">
                                <input type="radio" name="rating" value="4" style="margin: 0;">
                                <span>Good (4)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: rgba(255,255,255,0.1); border-radius: 8px; border: 1px solid rgba(255,255,255,0.2);">
                                <input type="radio" name="rating" value="3" style="margin: 0;">
                                <span>Average (3)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: rgba(255,255,255,0.1); border-radius: 8px; border: 1px solid rgba(255,255,255,0.2);">
                                <input type="radio" name="rating" value="2" style="margin: 0;">
                                <span>Poor (2)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 12px; background: rgba(255,255,255,0.1); border-radius: 8px; border: 1px solid rgba(255,255,255,0.2);">
                                <input type="radio" name="rating" value="1" style="margin: 0;">
                                <span>Very Poor (1)</span>
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-size: 14px; opacity: 0.9;">
                            Any comments or suggestions?
                        </label>
                        <textarea id="feedbackComments" rows="4" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.1); color: white; font-family: inherit; font-size: 14px; resize: vertical;" placeholder="Share your thoughts about the interview experience..."></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 8px;">
                        <button type="button" id="skipFeedbackBtn" class="setup-secondary" style="padding: 10px 20px;">Skip</button>
                        <button type="submit" class="setup-primary" style="padding: 10px 20px;">Submit Feedback</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Final Completion Screen -->
    <div id="finalCompletionScreen" class="report-overlay hidden" style="z-index: 10000;">
        <div style="text-align: center; padding: 60px 40px; max-width: 600px; margin: 0 auto;">
            <div style="font-size: 80px; margin-bottom: 30px;">‚úÖ</div>
            <h1 style="font-size: 32px; margin-bottom: 20px; color: var(--text-primary);">Interview Complete!</h1>
            <p style="font-size: 18px; margin-bottom: 30px; color: var(--text-secondary); line-height: 1.6;">
                Your interview session has been successfully completed.
            </p>
            <div style="background: rgba(255,255,255,0.1); border-radius: 16px; padding: 30px; margin: 30px 0;">
                <h2 style="font-size: 24px; margin-bottom: 20px; color: var(--text-primary);">Please Wait</h2>
                <p style="font-size: 16px; color: var(--text-secondary); line-height: 1.8; margin-bottom: 20px;">
                    Your responses have been recorded and submitted. Our team will review your interview and get back to you soon.
                </p>
                <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-top: 20px;">
                    <div class="spinner" style="width: 24px; height: 24px; border: 3px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                    <span style="color: var(--text-secondary);">Processing your interview...</span>
                </div>
            </div>
            <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid rgba(255,255,255,0.1);">
                <p style="font-size: 14px; color: var(--text-secondary); opacity: 0.8;">
                    You can safely close this tab. We have your interview data saved.
                </p>
                <button id="closeTabBtn" class="setup-primary" style="margin-top: 20px; padding: 12px 30px;">
                    Close Tab
                </button>
            </div>
        </div>
    </div>

    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .spinner {
            animation: spin 1s linear infinite;
        }
    </style>
    <script src="app.js" defer></script>
</body>
</html>

